<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Chat Test</h1>
    <div>
        <label for="room-name">Room Name:</label>
        <input type="text" id="room-name" value="test_room">
        <button id="connect-btn">Connect</button>
    </div>
    <div>
        <label for="message">Message:</label>
        <input type="text" id="message">
        <button id="send-btn">Send</button>
    </div>
    <div>
        <h2>Messages:</h2>
        <ul id="messages"></ul>
    </div>

    <script>
        let socket = null;
        const connectBtn = document.getElementById('connect-btn');
        const sendBtn = document.getElementById('send-btn');
        const messageInput = document.getElementById('message');
        const roomNameInput = document.getElementById('room-name');
        const messagesList = document.getElementById('messages');

        connectBtn.addEventListener('click', function() {
            const roomName = roomNameInput.value;
            if (roomName) {
                if (socket) {
                    socket.close();
                }
                // Connect to WebSocket
                socket = new WebSocket(`ws://127.0.0.1:8000/ws/chat/${roomName}/`);

                socket.onopen = function(e) {
                    addMessage('Connected to chat room: ' + roomName);
                };

                socket.onmessage = function(e) {
                    const data = JSON.parse(e.data);
                    if (data.type === 'chat_message') {
                        addMessage(`Received: ${data.message.content} from user ${data.message.sender_name}`);
                    }
                };

                socket.onclose = function(e) {
                    addMessage('Disconnected from chat room');
                };

                socket.onerror = function(e) {
                    addMessage('Error: ' + e.message);
                };
            }
        });

        sendBtn.addEventListener('click', function() {
            const message = messageInput.value;
            if (socket && message) {
                const data = {
                    'type': 'chat_message',
                    'content': message,
                    'sender_id': 1, // Replace with the actual user ID
                    'chatroom_id': 1, // Replace with actual chatroom ID
                };
                socket.send(JSON.stringify(data));
                messageInput.value = '';
            }
        });

        function addMessage(message) {
            const li = document.createElement('li');
            li.textContent = message;
            messagesList.appendChild(li);
        }
    </script>
</body>
</html>
